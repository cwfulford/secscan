<h2 id="heading1">NAME</h2>
<p class="indent">
<b><a href="./scripts.php?script=secscan">secscan</a></b>
- runs security systems applications on remote servers and raises alerts
where problems are found. 
</p>
<h2 id="heading2">SYNOPSIS</h2>
<p class="indent">

<b><a href="./scripts.php?script=secscan">secscan</a></b>
 [ -a &lt;rootkit:filename&gt;] [
<b>-c </b>
<i>&lt;config_file&gt;</i>
] [
<b>-d</b>
] [
<b>-e </b>
<i>&lt;rcpt&gt;</i>
]
[
<b>-l</b>
] [
<b>-t</b>
 #] [
<b>-u</b>
] [
<b>-U</b>
] [
<b>-v</b>
] 
<i>&lt;hostname&gt;</i>

</p>
<h2 id="heading3">AVAILABILITY</h2>
<p class="indent">
<b><a href="./scripts.php?script=secscan">secscan</a></b>
was written as a Bourne shell script which should work equally well on all
versions of UNIX
and Linux. Unfortunately variables set in nested if statements do not
consistently retain their values outside the if construct when using 64bit
<b>bash.</b>
The script works as expected with ksh.
</p>
<h2 id="heading4">DESCRIPTION</h2>
<p class="indent">
The purpose of
<b><a href="./scripts.php?script=secscan">secscan</a></b>
is to check the integrity of security applications 
on remote hosts before running them. If all is well the remote  
software tools are run and the output checked to determine whether an 
alert needs to be raised.
</p>
<p class="indent">
In normal operation 
<b><a href="./scripts.php?script=secscan">secscan</a></b>
will take 
<i>sha1</i>
checksums of "
<i>rkhunter</i>
" and "
<i>rkhunter.conf</i>
" on the remote host
and compare them to checksums stored on the invoking "
<i>administration</i>
"
host. If the checksums deviate from the known checksums an alert is raised.
by sending e-mail to the
<b>root</b>
user on the host from which
<b><a href="./scripts.php?script=secscan">secscan</a></b>
is invoked.
</p>
<h2 id="heading5">OPTIONS</h2>
<p class="indent">
</p>
<p class="indent">

<b>-a </b>
<i>&lt;rootkit:filename&gt;</i>

<br/>
The 
<b>-a</b>&nbsp;&nbsp;&nbsp;
option allows a file to be removed from the list of files associated with the
prescence of a particular root kit.
</p>
<p class="indent">
This option arises from the use of
<b><a href="./scripts.php?script=secscan">secscan</a></b>
on a
<b>Slackware</b>
host where the quite legitimate presence of 
<i>"/etc/ssh/sshd_config"</i>
generates a warning regarding a possible infection of Dica-Kit from 
<b>rkhunter.</b>
</p>
<p class="indent">
The use of 
<b>-a Dica-Kit:/etc/ssh/sshd_config</b>
will create an amended temporary version of
<b>rkhunter</b>
which has 
<i>sshd_config</i>
removed from the list of files associated with
<i>Dica-Kit</i>.
</p>
<p class="indent">

<b>-c </b>
<i>&lt;configuration_file&gt;</i>

By default 
<b><a href="./scripts.php?script=secscan">secscan</a></b>
finds the configuration using a default path and
<i>&lt;hostname&gt;</i>
from the command line i.e.

<i>/usr/local/etc/secscan.d/&lt;hostname&gt;.cf</i>
". The 
<b>-c</b>&nbsp;&nbsp;&nbsp;
option allows a different path to be used, perhaps for testing modifications
or to use a common configuration over a number of hosts. The file name
<i>&lt;hostname&gt;.cf</i>
will be appended to the path. The same path will be used to store the
checksums generated. By default the checksums are stored in

<i>/usr/local/etc/secscan.d/&lt;hostname&gt;.sha1</i>
.
</p>
<p class="indent">
<b>-d</b>&nbsp;&nbsp;&nbsp;
set debug mode. The
<b>-x </b>
option will be set for the shell and a number of break points will be used to
allow output to be considered before proceeding.
</p>
<p class="indent">

<b>-e</b>&nbsp;&nbsp;&nbsp;
<i> &lt;recipient&gt;</i>

By default alerts are sent to the
<b>root</b>
user on the host invoking
<b>secscan.</b>
The 
<b>-e</b>&nbsp;&nbsp;&nbsp;
option is used to set a different email recipient for the alerts. It is good
practice to set an alias for root in 
<i>/etc/aliases</i>
which will ensure the correct user gets all the systems critical messages.
When staff changes occur only this one change to the 
<i>aliases</i>
 file will
be needed.
</p>
<p class="indent">
<b>-l</b>&nbsp;&nbsp;&nbsp;
Use the  
<i>&lt;syslog&gt;</i>
facility to log the invocation of
<b><a href="./scripts.php?script=secscan">secscan</a> </b>
and the 
<i>update</i>
level (see update options below). Logging script invocations is very useful
where regualr reports need to be generated for required for clients or managers,
</p>
<p class="indent">

<b>-t #</b>

Set a tolerance level for warnings generated by 
<b>rkhunter.</b>
Where warnings are routinely issued regarding known issues it useful to be
able to disregard them and not generate any alerts.
</p>
<p class="indent">
<b>-u</b>&nbsp;&nbsp;&nbsp;
The script will use 
<i>shasum</i>
on the remote host to generate new checksums for "
<i>rkhunter</i>
" and it's
configuration file "
<i>rkhunter.conf</i>
". The checksums will 
be stored on the host invoking
<b><a href="./scripts.php?script=secscan">secscan</a></b>
in the file 
<i>/usr/local/etc/secscan.d/&lt;hostname&gt;.sha1</i>
. The update is
loged if the 
<b>-l</b>&nbsp;&nbsp;&nbsp;
option has been used.
</p>
<p class="indent">
<b>-U</b>&nbsp;&nbsp;&nbsp;
In addition to the checksum updates initiated by the 
<b>-u </b>
option the
<b>rkhunter</b>
properties database is also updated. 
</p>
<p class="indent">

<b>-v</b>&nbsp;&nbsp;&nbsp;

Use verbose mode. Each significant action will be reported to 
<i>stdout</i>.
</p>
<p class="indent">
<i>&lt;hostname&gt;</i>
This is a required parameter and sets the target host name or IP.
</p>
<h2 id="heading6">EXAMPLES</h2>
<p class="indent">

</p><div class="cmdline">
<pre>
secscan -l -t 2 -u  boudica
</pre></div>
<p class="indent">
</p>
<p class="indent">
Use 
<i>/usr/local/etc/secscan.d/boudica.cf</i>
to determine which scans to run on the host "
<i>boudica"</i>
.
</p>
<p class="indent">
Create or update the checksums for the remote executables and their
associated configuration files (i.e. 

<b>rkhunter</b>
 and 
<b>rkhunter.conf</b>
).
</p>
<p class="indent">
If there are no more that 2 warnings issued, all is well.  If there are
more than 2, send urgent email to the root user, on the current
(administration) host.

</p><div class="cmdline">
<pre>
secscan -l -t 2 arthur
</pre></div>
<p class="indent">
</p>
<p class="indent">
Use 
<i>/usr/local/etc/secscan.d/boudica.cf</i>
to determine which scans to run on the host "
<i>arthur"</i>
.
</p>
<p class="indent">
Compare the checksums for the current instances of the scanning tools
and associated configuration files with the checksums held on administration
server (the host invoking the secscan command).
associated configuration files (i.e. 

<b>rkhunter</b>
 and 
<b>rkhunter.conf</b>
). If the files are not identical
send an urgent alert to the locally defined 
<i>root</i>
user and terminate.
</p>
<p class="indent">
If there is no sign of the tools to be invoked being compromised, run them
on the remote host.
</p>
<p class="indent">
<b>NB:</b>
<b>rkhunter</b>
is run first with the 
<b>--update</b>
option to update it's text data files. It is then run again with the
<b>--check</b>
option to scan the system and generate it's reports.
</p>
<h2 id="heading8">BUGS</h2>
<p class="indent">
The script has very little input error checking. Name resolution and
network availability is not checked. It is designed to be used
with frequently used host names where
<b>ssh </b>
keys have already been exchanged.
</p>
<p class="indent">
I cobbled together
<b>secscan</b>
rather quickly in the expectation that
a number of software scanning tools would be used but currently 
<b>rkhunter</b>
is the only one and is hard coded. The configuration file is unused, this
will change.
</p>
<p class="indent">
There appears to be bug in Slackware 64bit 
<b>bash</b>
shell (see 
<b>AVAILABILITY</b>
above) which causes the script to continue executing
after errors which might indicate that the scanning software or configuration
files have been compromised. To avoid this problem the 
<b>korn</b>
shell is being used pro temp.
</p>
<h2 id="heading9">SEE ALSO</h2>
<p class="indent">
<a href="./scripts.php?script=chkdf&amp;man=y"><i>chkdf</i>,</a>
<a href="./scripts.php?script=chkftpd&amp;man=y"><i>chkftpd</i>,</a>
<a href="./scripts.php?script=chkfw&amp;man=y"><i>chkfw</i>.</a>
</p>
<h2 id="heading10">AUTHOR</h2>
<p class="indent">
Clifford W Fulford, City Linux. Contact fulford@fulford.net or +44 (0)709 229 5385.
</p>
	
