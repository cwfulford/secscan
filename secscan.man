.TH SECSCAN 8l "1 October rsecscan
.SH NAME
.B secscan
- runs security systems applications on remote servers and raises alerts
where problems are found. 
.SH SYNOPSIS
\fBsecscan\fR [ -a <rootkit:filename>] [\fB-c \fI<config_file>\fR] [\fB-d\fR] [\fB-e \fI<rcpt>\fR]
[\fB-l\fR] [\fB-t\fR #] [\fB-u\fR] [\fB-U\fR] [\fB-v\fR] \fI<hostname>\fR
.SH AVAILABILITY
.B secscan
was written as a Bourne shell script which should work equally well on all
versions of UNIX
and Linux. Unfortunately variables set in nested if statements do not
consistently retain their values outside the if construct when using 64bit
.BR bash .
The script works as expected with ksh.
.SH DESCRIPTION
The purpose of
.B secscan
is to check the integrity of security applications 
on remote hosts before running them. If all is well the remote  
software tools are run and the output checked to determine whether an 
alert needs to be raised.
.LP
In normal operation 
.B secscan
will take 
.I sha1
checksums of "\fIrkhunter\fR" and "\fIrkhunter.conf\fR" on the remote host
and compare them to checksums stored on the invoking "\fIadministration\fR"
host. If the checksums deviate from the known checksums an alert is raised.
by sending e-mail to the
.B root
user on the host from which
.B secscan
is invoked.
.SH OPTIONS
.TP 5
\fB-a \fI<rootkit:filename>\fR
.br
The 
.B -a
option allows a file to be removed from the list of files associated with the
prescence of a particular root kit.
.IP
This option arises from the use of
.B secscan
on a
.B Slackware
host where the quite legitimate presence of 
.I "/etc/ssh/sshd_config"
generates a warning from
.B rkhunter
regarding a possible infection by 
.BR Dica-Kit .
.IP
The use of 
.B -a Dica-Kit:/etc/ssh/sshd_config
will create an amended, temporary version of
.B rkhunter
which has had 
.I sshd_config
removed from the list of files associated with
.IR Dica-Kit .
.TP 5
\fB-c \fI<configuration_file>\fR
By default 
.B secscan
finds the configuration using a default path and
.I <hostname>
from the command line i.e.
\fI/usr/local/etc/secscan.d/<hostname>.cf\fR". The 
.B -c
option allows a different path to be used, perhaps for testing modifications
or to use a common configuration over a number of hosts. The file name
.I <hostname>.cf
will be appended to the path. The same path will be used to store the
checksums generated. By default the checksums are stored in
\fI/usr/local/etc/secscan.d/<hostname>.sha1\fR.
.TP 5
.B -d
set debug mode. The
.B -x 
option will be set for the shell and a number of break points will be used to
allow output to be considered before proceeding.
.TP 5
\fB-e\fI <recipient>\fR
By default alerts are sent to the
.B root
user on the host invoking
.BR secscan .
The 
.B -e
option is used to set a different email recipient for the alerts. It is good
practice to set an alias for root in 
.I /etc/aliases
which will ensure the correct user gets all the systems critical messages.
When staff changes occur only this one change to the \fIaliases\fR file will
be needed.
.TP 5
.B -l
Use the  
.I <syslog>
facility to log the invocation of
.B secscan 
and the 
.I update
level (see update options below). Logging script invocations is very useful
where regualr reports need to be generated for required for clients or managers,
.TP 5
\fB-t #\fR
Set a tolerance level for warnings generated by 
.BR rkhunter .
Where warnings are routinely issued regarding known issues it useful to be
able to disregard them and not generate any alerts.
.TP 5
.B -u
The script will use 
.I shasum
on the remote host to generate new checksums for "\fIrkhunter\fR" and it's
configuration file "\fIrkhunter.conf\fR". The checksums will 
be stored on the host invoking
.BR secscan 
in the file \fI/usr/local/etc/secscan.d/<hostname>.sha1\fR. The update is
loged if the 
.B -l
option has been used.
.TP 5
.B -U
In addition to the checksum updates initiated by the 
.B -u 
option the
.B rkhunter
properties database is also updated. 
.TP 5
\fB-v\fR
Use verbose mode. Each significant action will be reported to 
.IR stdout .
.TP 5
.I <hostname>
This is a required parameter and sets the target host name or IP.
.SH EXAMPLES
.IP
.nf
.ft CW
secscan -l -t 2 -u  boudica
.fi
.ft R
.LP
Use 
.I /usr/local/etc/secscan.d/boudica.cf
to determine which scans to run on the host "\fIboudica"\fR.
.LP
Create or update the checksums for the remote executables and their
associated configuration files (i.e. 
\fBrkhunter\fR and \fBrkhunter.conf\fR).
.LP
If there are no more that 2 warnings issued, all is well.  If there are
more than 2, send urgent email to the root user, on the current
(administration) host.
.IP
.nf
.ft CW
secscan -l -t 2 arthur
.fi
.ft R
.LP
Use 
.I /usr/local/etc/secscan.d/boudica.cf
to determine which scans to run on the host "\fIarthur"\fR.
.LP
Compare the checksums for the current instances of the scanning tools
and associated configuration files with the checksums held on administration
server (the host invoking the secscan command).
associated configuration files (i.e. 
\fBrkhunter\fR and \fBrkhunter.conf\fR). If the files are not identical
send an urgent alert to the locally defined 
.I root
user and terminate.
.LP
If there is no sign of the tools to be invoked being compromised, run them
on the remote host.
.LP
.B NB:
.B rkhunter
is run first with the 
.B --update
option to update it's text data files. It is then run again with the
.B --check
option to scan the system and generate it's reports.
.SH BUGS
The script has very little input error checking. Name resolution and
network availability is not checked. It is designed to be used
with frequently used host names where
.B ssh 
keys have already been exchanged.
.LP
I cobbled together
.B secscan
rather quickly in the expectation that
a number of software scanning tools would be used but currently 
.B rkhunter
is the only one and is hard coded. The configuration file is unused, this
will change.
.LP
There appears to be bug in Slackware 64bit 
.B bash
shell (see 
.B AVAILABILITY
above) which causes the script to continue executing
after errors which might indicate that the scanning software or configuration
files have been compromised. To avoid this problem the 
.B korn
shell is being used pro temp.
.SH SEE ALSO
.IR chkdf ,
.IR chkftpd ,
.IR chkfw .
.SH AUTHOR
Clifford W Fulford, City Linux. Contact fulford@fulford.net or +44 (0)709 229 5385.
